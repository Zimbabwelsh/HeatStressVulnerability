require(raster)
require(lavaan)

setwd("C:/Users/gg9824/Dropbox/00ESRC Fellowship/Projects/Heat Stress/CC Heat Stress IMD")

names <- c("Tmax95_past", "VP95_past", "Tmin95_past", "DD66_past")

## Read in netcdf layers as single column dataframes

for (i in names){
  data  <- raster("heat_hazards_2.nc", varname = i)
  name <- paste0(i)
  assign(name, as.data.frame(values(data)))
}

## combine dataframes and rename columns
df <- na.omit(data.frame(Tmax95_past, VP95_past, Tmin95_past, DD66_past))
colnames(df) <- names

## Specify correlated unidimensional factor model
risk.model <- " climate1 =~ Tmax95_past + VP95_past + Tmin95_past + DD66_past"
fit <- cfa(risk.model, data=df, std.lv=T)

## Inspect output - with fit statistics
summary(fit, standardized=TRUE, fit.measures= TRUE)
                

